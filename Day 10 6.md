Day 10





**Q. Setup Auto Scaling**


Create a Template -> us-east-1a -> select security group-> allow port 22 (SSH) -> run script if any->launch



select the template -> actions -> create auto scaling group



Instance type requirement ->



Manual -> t2.micro



Name -> on demand instance -> 2



Network select 1a,1b,1c,1d



Next -> load balancer -> attach new -> internet facing -> Create a target group -> No VPC -> Next



Group capacity -> desired 2 -> scaling min 2 max 6 -> Target tracking scaling policy -> avg cpu utilization -> target value 50 -> instance warmup 180 secs



Instance maintenance -> Launch before terminating or custom -> next



create autoscaling group -> wait for it to go live



top command to check cpu utilization



DONT RUN THIS COMMAND - ITS FOR TESTING PURPOSE (NOT TO BE RUN ON PRODUCTION OR DEVELOPMENT)

THIS COMMAND IS USED TO GIVE STRESS ON THE CPU -> yes > /dev/null \&   (also note the process name to kill it easily)



then top to check cpu utilization again



Wait 3 mins till 6 machines go up -



TO KILL ->

Kill 26531 (process name)



------------------------------------------------------------------------------------------------------------------------



VPC IS A REGION BASED SERVICE - in every region by default there is one vpc



Q. Hosting a VPC -



V - VPC -> cidr 10.0.0.0/16
I - IGW
S - Subnet
R - Route Table



-Search VPC 

-Create VPC

* Vpc Setting -> vpc only - no ipv6 cidr -> give range 10.0.0.0/16 -> create
* FOR OHIO GIVE - 20.0.0.0/16



Now make IGW(internet gateway)

Name tag - devops-igw -> create



Now go to subnet -:

Create subnet ->  -> devops-vpc -> give name -public subnet  -> zone us-east-1a -> subnet cidr -> 10.0.0.0/24 -> create subnet

FOR OHIO 20.0.0.0/24



Create another subnet -> private subnet -> us-east-1b -> 10.0.1.0/24-> create

FOR OHIO 20.0.1.0/24



Now launch a instance- select devops-vpc - select public subnet -> enable auto assign public ip->allow port ssh 22 -> script if any -> launch instance

Launch another instance - select devops-vpc ->select private subnet -> subnet cidr -> disable auto assign public ip -> 10.0.1.0/24 -> allow 22  -> launch instance

Go to IGW -> select the igw -> attach to devops-vpc

Go to Route tables -> create -> name it -> select devops vpc -> create -> edit route -> cidr 0.0.0.0/0 and add route internet gateway -> create

edit subnet association -> edit and add public -> save
	
Go to instance and allow ICMP ipv4 protocol in inbound rules -> save


Connect the public machine in terminal


Copy the content from the key pair in the computer.

GO to the public machine vim devops-host.pem -> and paste the key save exit

chmod 400 devops-host.pem



ssh -i devops-host.pem ec2-user@privateip of private machine



NOW YOU WILL BE CONNECTED TO THE PRIVATE MACHINE



-----------------------------------------------------------------------------------------------------
Q. Now to use internet in private machine


GO to NAT Gateway

Name anything -> subnet public -> public ip ->allocate elastic ip->  create

Go to route table -> create route table private rt name -> devops -> create

then edit route -> add route -> nat gateway -> save

go to route table subnet assoications -> edit and add private-subnet there



Now go to instance and ping google.com and it will



Q. Create a vpc with 2 subnet -> in public deploy one web server in private deploy one and private should be available publicly


-----------------------------------------------------------------------------------------------------------------------------------------

Q. Transfer data between different region



Do the above VPC step in OHIO region too


Q. Transfer data between different region


Create file in North virginia - cat > filename.txt

Create a file in ohio too -> cat > file2.txt

In NV
systemctl start sshd
systemctl enable sshd

enable -> 40 & 65 yes in vim/etc/ssh/sshd_config

ssh-keygen
cd .ssh/
cat id_rsa.pub -> copy it


In ohio
cd .ssh/ 
vim authorized_keys paste the id_rsa


In NV
scp filename.txt root@publicipofohio:/tmp

cd /tmp/ in ohio -> file will be there

vice versa for nv to ohio

-----------------------------------------------------------------------------------

NOW DO VIA VPC PEERING

GO TO NV -> PEERING CONNECTION (SEARCH VPC TO FIND IT)

name->nvtoohio

vpc Id -> your vpc id

region another select ohio (go to vpc in ohio and copy vpc id)
paste the id
create 


Now go to ohio -> peering connection => you will find request (it will take time)
Select -> actions -> accept request -> wait till it go active

Add 20.0.0.0 /16 in NV region  -> routing table -> select peering connection

Add 10.0.0.0 /16 in OHIO region  -> routing table -> select peering connection
allow icmp ipv4 in both region security group


ping on both private ip and it will connect


